import{_ as te,v as c,h,P as le,c as T,l as t,w as a,ao as F,aB as p,aC as n,am as M,o as V,aE as ae,ap as oe,i as ne,aF as se,a as s,J as N,E as re,p as ie,aD as ue,as as r}from"./index-rlLqkN85.js";import{E as de,a as me}from"./el-overlay-B_T0GCAX.js";import{E as ce,a as pe}from"./el-form-item-lP9qSaeU.js";/* empty css                 */import{E as _e}from"./el-input-number-CZcOxADP.js";import{E as ve,a as fe}from"./el-col-tUWAZgcH.js";import{c as ge,d as ye,e as C}from"./el-table-column-BaYVN9q_.js";import{E as Ee,b as be}from"./el-card-BbBQd83r.js";import"./_baseClone-YwL6KHsF.js";import"./debounce-CdLqkdsx.js";const xe={class:"card-header"},we={class:"set-name"},Ve={class:"card-header"},Ce={class:"dialog-footer"},Ie={__name:"SettingsView",setup(Se){const d=c([]),u=c(null),v=c([]),_=c(!1),g=c(!1),i=c({}),y=c(!1),U=h(()=>g.value?"编辑评分项":"新增评分项"),z=h(()=>{const l=d.value.find(e=>e.id===u.value);return l?l.name:"请先选择或新增一个评分组"}),E=async()=>{try{const l=await p.get("/scoring-sets");d.value=l.data.data,d.value.length>0&&!u.value?b(d.value[0].id.toString()):d.value.length===0&&(v.value=[])}catch{n.error("获取评分组列表失败")}},A=()=>{C.prompt("请输入新的评分组名称 (如: 就业赛道)","新增评分组",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:l=>l&&l.trim()!==""?!0:"名称不能为空"}).then(async({value:l})=>{try{await p.post("/scoring-sets",{name:l}),n.success("新增成功！"),await E(),d.value.length>0&&b(d.value[d.value.length-1].id.toString())}catch{n.error("新增失败，可能是名称重复！")}}).catch(()=>{})},J=l=>{C.confirm(`确定删除【${l.name}】吗？其下的所有评分项将一并被删除！`,"严重警告",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await p.delete(`/scoring-sets/${l.id}`),n.success("删除成功！"),u.value=null,E()}catch{n.error("删除失败！")}})},b=l=>{u.value=parseInt(l),x()},x=async()=>{if(!u.value){v.value=[];return}try{const l=await p.get(`/scoring-sets/${u.value}/items`);v.value=l.data.data}catch{v.value=[],n.error("获取评分项列表失败")}},L=()=>{g.value=!1,i.value={name:"",description:"",max_score:10},_.value=!0},O=l=>{g.value=!0,i.value={...l},_.value=!0},P=l=>{C.confirm(`确定要删除评分项【${l.name}】吗？`,"确认",{type:"warning"}).then(async()=>{try{await p.delete(`/scoring-items/${l.id}`),n.success("删除成功！"),x()}catch{n.error("删除失败！")}})},R=async()=>{try{g.value?(await p.put(`/scoring-items/${i.value.id}`,i.value),n.success("更新成功！")):(await p.post(`/scoring-sets/${u.value}/items`,i.value),n.success("添加成功！")),_.value=!1,x()}catch{n.error("操作失败！")}},j=l=>{n.success(l.message||"导入成功！"),y.value=!1,u.value=null,E()},q=l=>{try{const e=JSON.parse(l.message);n.error(e.error||"导入失败，请检查文件格式或内容。")}catch{n.error("导入失败，请检查文件格式或联系服务器。")}};return le(E),(l,e)=>{const m=ue,G=M("Delete"),I=re,H=se,K=ae,S=Ee,k=fe,f=ye,Q=ge,W=ve,B=be,w=pe,X=_e,Y=ce,D=de,Z=M("upload-filled"),ee=me;return V(),T(F,null,[t(W,{gutter:20},{default:a(()=>[t(k,{span:6},{default:a(()=>[t(S,null,{header:a(()=>[s("div",xe,[e[9]||(e[9]=s("span",null,"评分组",-1)),s("div",null,[t(m,{type:"success",size:"small",onClick:e[0]||(e[0]=o=>y.value=!0)},{default:a(()=>[...e[7]||(e[7]=[r("导入",-1)])]),_:1}),t(m,{type:"primary",size:"small",onClick:A},{default:a(()=>[...e[8]||(e[8]=[r("新增",-1)])]),_:1})])])]),default:a(()=>[t(K,{"default-active":u.value?.toString(),onSelect:b},{default:a(()=>[(V(!0),T(F,null,oe(d.value,o=>(V(),ne(H,{key:o.id,index:o.id.toString()},{default:a(()=>[s("span",we,N(o.name),1),t(I,{class:"delete-icon",onClick:ie($=>J(o),["stop"])},{default:a(()=>[t(G)]),_:1},8,["onClick"])]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),_:1})]),_:1}),t(k,{span:18},{default:a(()=>[t(S,null,{header:a(()=>[s("div",Ve,[s("span",null,"评分项列表 - "+N(z.value),1),t(m,{type:"primary",onClick:L,disabled:!u.value},{default:a(()=>[...e[10]||(e[10]=[r("添加评分项",-1)])]),_:1},8,["disabled"])])]),default:a(()=>[t(Q,{data:v.value,border:"",stripe:""},{default:a(()=>[t(f,{prop:"id",label:"ID",width:"60",align:"center"}),t(f,{prop:"name",label:"评分项名称"}),t(f,{prop:"description",label:"简介","show-overflow-tooltip":""}),t(f,{prop:"max_score",label:"满分",width:"80",align:"center"}),t(f,{label:"操作",width:"150",align:"center"},{default:a(({row:o})=>[t(m,{type:"primary",size:"small",onClick:$=>O(o)},{default:a(()=>[...e[11]||(e[11]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(m,{type:"danger",size:"small",onClick:$=>P(o)},{default:a(()=>[...e[12]||(e[12]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),t(D,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=o=>_.value=o),title:U.value,width:"500","append-to-body":""},{footer:a(()=>[s("div",Ce,[t(m,{onClick:e[4]||(e[4]=o=>_.value=!1)},{default:a(()=>[...e[13]||(e[13]=[r("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:R},{default:a(()=>[...e[14]||(e[14]=[r("确定",-1)])]),_:1})])]),default:a(()=>[t(Y,{model:i.value,"label-width":"100px"},{default:a(()=>[t(w,{label:"名称"},{default:a(()=>[t(B,{modelValue:i.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.name=o)},null,8,["modelValue"])]),_:1}),t(w,{label:"简介"},{default:a(()=>[t(B,{modelValue:i.value.description,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.description=o),type:"textarea"},null,8,["modelValue"])]),_:1}),t(w,{label:"满分"},{default:a(()=>[t(X,{modelValue:i.value.max_score,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.max_score=o),min:1,max:1e3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(D,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=o=>y.value=o),title:"批量导入评分组与评分项 (Excel)",width:"500","append-to-body":""},{default:a(()=>[t(ee,{drag:"",action:"/api/scoring-sets/import",name:"scoringFile",limit:1,"on-success":j,"on-error":q,accept:".xlsx, .xls"},{tip:a(()=>[...e[15]||(e[15]=[s("div",{class:"el-upload__tip"},[r(" 请上传 Excel 文件 (.xlsx, .xls)，且 **不要有表头**。"),s("br"),r(" - **A 列**: 评分组 (例如: 就业赛道)"),s("br"),r(" - **B 列**: 评分项名称 (例如: 职业目标)"),s("br"),r(" - **C 列**: 简介 (选填)"),s("br"),r(" - **D 列**: 满分 (例如: 50) ")],-1)])]),default:a(()=>[t(I,{class:"el-icon--upload"},{default:a(()=>[t(Z)]),_:1}),e[16]||(e[16]=s("div",{class:"el-upload__text"},[r(" 拖拽文件到此处 或 "),s("em",null,"点击上传")],-1))]),_:1})]),_:1},8,["modelValue"])],64)}}},ze=te(Ie,[["__scopeId","data-v-a7c68137"]]);export{ze as default};
