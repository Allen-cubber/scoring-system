import{_ as Q,q as m,f as S,L as W,c as $,j as t,w as l,ae as B,ac as X,o as x,aE as Y,af as Z,g as ee,aF as te,a as v,F as D,E as ae,l as le,ai as p}from"./index-Cpax_Axq.js";import{E as ne,a as oe,b as se}from"./el-form-item-DphxtwNG.js";/* empty css                 */import{E as re}from"./el-input-number-B-ixSUEl.js";import{E as ue,a as ie}from"./el-col-DLCcEYMz.js";import{d as de,e as ce,f as V}from"./el-table-column-B8049T5l.js";import{s as i,E as s,l as me,m as pe,p as _e}from"./request-Dm9EjiGZ.js";const fe={class:"card-header"},ve={class:"set-name"},ge={class:"card-header"},ye={__name:"SettingsView",setup(Ee){const r=m([]),u=m(null),_=m([]),d=m(!1),g=m(!1),o=m({}),T=S(()=>g.value?"编辑评分项":"新增评分项"),F=S(()=>{const a=r.value.find(e=>e.id===u.value);return a?a.name:"请先选择或新增一个评分组"}),y=async()=>{try{const a=await i.get("/scoring-sets");r.value=a.data.data,r.value.length>0&&!u.value?E(r.value[0].id.toString()):r.value.length===0&&(_.value=[])}catch{s.error("获取评分组列表失败")}},M=()=>{V.prompt("请输入新的评分组名称 (如: 就业赛道)","新增评分组",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:a=>a&&a.trim()!==""?!0:"名称不能为空"}).then(async({value:a})=>{try{await i.post("/scoring-sets",{name:a}),s.success("新增成功！"),await y(),r.value.length>0&&E(r.value[r.value.length-1].id.toString())}catch{s.error("新增失败，可能是名称重复！")}}).catch(()=>{})},N=a=>{V.confirm(`确定删除【${a.name}】吗？其下的所有评分项将一并被删除！`,"严重警告",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await i.delete(`/scoring-sets/${a.id}`),s.success("删除成功！"),u.value=null,y()}catch{s.error("删除失败！")}})},E=a=>{u.value=parseInt(a),b()},b=async()=>{if(!u.value){_.value=[];return}try{const a=await i.get(`/scoring-sets/${u.value}/items`);_.value=a.data.data}catch{_.value=[],s.error("获取评分项列表失败")}},U=()=>{g.value=!1,o.value={name:"",description:"",max_score:10},d.value=!0},z=a=>{g.value=!0,o.value={...a},d.value=!0},A=a=>{V.confirm(`确定要删除评分项【${a.name}】吗？`,"确认",{type:"warning"}).then(async()=>{try{await i.delete(`/scoring-items/${a.id}`),s.success("删除成功！"),b()}catch{s.error("删除失败！")}})},L=async()=>{try{g.value?(await i.put(`/scoring-items/${o.value.id}`,o.value),s.success("更新成功！")):(await i.post(`/scoring-sets/${u.value}/items`,o.value),s.success("添加成功！")),d.value=!1,b()}catch{s.error("操作失败！")}};return W(y),(a,e)=>{const c=pe,j=X("Delete"),q=ae,R=te,G=Y,C=me,h=ie,f=ce,H=de,J=ue,k=_e,w=se,K=re,O=oe,P=ne;return x(),$(B,null,[t(J,{gutter:20},{default:l(()=>[t(h,{span:6},{default:l(()=>[t(C,null,{header:l(()=>[v("div",fe,[e[6]||(e[6]=v("span",null,"评分组",-1)),t(c,{type:"primary",size:"small",onClick:M},{default:l(()=>[...e[5]||(e[5]=[p("新增组",-1)])]),_:1})])]),default:l(()=>[t(G,{"default-active":u.value?.toString(),onSelect:E},{default:l(()=>[(x(!0),$(B,null,Z(r.value,n=>(x(),ee(R,{key:n.id,index:n.id.toString()},{default:l(()=>[v("span",ve,D(n.name),1),t(q,{class:"delete-icon",onClick:le(I=>N(n),["stop"])},{default:l(()=>[t(j)]),_:1},8,["onClick"])]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),_:1})]),_:1}),t(h,{span:18},{default:l(()=>[t(C,null,{header:l(()=>[v("div",ge,[v("span",null,"评分项列表 - "+D(F.value),1),t(c,{type:"primary",onClick:U,disabled:!u.value},{default:l(()=>[...e[7]||(e[7]=[p("添加评分项",-1)])]),_:1},8,["disabled"])])]),default:l(()=>[t(H,{data:_.value,border:"",stripe:""},{default:l(()=>[t(f,{prop:"id",label:"ID",width:"60"}),t(f,{prop:"name",label:"评分项名称"}),t(f,{prop:"description",label:"简介"}),t(f,{prop:"max_score",label:"满分",width:"80"}),t(f,{label:"操作",width:"150",align:"center"},{default:l(({row:n})=>[t(c,{type:"primary",size:"small",onClick:I=>z(n)},{default:l(()=>[...e[8]||(e[8]=[p("编辑",-1)])]),_:1},8,["onClick"]),t(c,{type:"danger",size:"small",onClick:I=>A(n)},{default:l(()=>[...e[9]||(e[9]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),t(P,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=n=>d.value=n),title:T.value,width:"500","append-to-body":""},{footer:l(()=>[t(c,{onClick:e[3]||(e[3]=n=>d.value=!1)},{default:l(()=>[...e[10]||(e[10]=[p("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:L},{default:l(()=>[...e[11]||(e[11]=[p("确定",-1)])]),_:1})]),default:l(()=>[t(O,{model:o.value,"label-width":"100px"},{default:l(()=>[t(w,{label:"名称"},{default:l(()=>[t(k,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.name=n)},null,8,["modelValue"])]),_:1}),t(w,{label:"简介"},{default:l(()=>[t(k,{modelValue:o.value.description,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.description=n),type:"textarea"},null,8,["modelValue"])]),_:1}),t(w,{label:"满分"},{default:l(()=>[t(K,{modelValue:o.value.max_score,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.max_score=n),min:1,max:100},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}},Ie=Q(ye,[["__scopeId","data-v-9b7f2657"]]);export{Ie as default};
