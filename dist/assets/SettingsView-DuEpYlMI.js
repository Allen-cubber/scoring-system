import{_ as te,q as m,f as h,L as le,c as T,j as t,w as a,ae as F,ac as M,o as V,ar as ae,af as oe,g as ne,as as se,a as n,F as N,E as re,l as ie,ai as r}from"./index-DV9UsM03.js";import{E as ue,a as de,b as ce,c as me}from"./el-form-item-B3o-P2zp.js";import"./el-input-BGXTqVK2.js";import{E as pe}from"./el-input-number-BX1ZjygX.js";import{E as _e,a as ve}from"./el-col-Dt_66aom.js";import{a as fe,c as ge,d as C}from"./el-table-column-C0a8BqhY.js";import{m as p,E as s,n as ye,o as be,p as xe}from"./request-CsyfuZvL.js";const Ee={class:"card-header"},we={class:"set-name"},Ve={class:"card-header"},Ce={class:"dialog-footer"},Ie={__name:"SettingsView",setup(Se){const d=m([]),u=m(null),v=m([]),_=m(!1),g=m(!1),i=m({}),y=m(!1),U=h(()=>g.value?"编辑评分项":"新增评分项"),z=h(()=>{const l=d.value.find(e=>e.id===u.value);return l?l.name:"请先选择或新增一个评分组"}),b=async()=>{try{const l=await p.get("/scoring-sets");d.value=l.data.data,d.value.length>0&&!u.value?x(d.value[0].id.toString()):d.value.length===0&&(v.value=[])}catch{s.error("获取评分组列表失败")}},A=()=>{C.prompt("请输入新的评分组名称 (如: 就业赛道)","新增评分组",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:l=>l&&l.trim()!==""?!0:"名称不能为空"}).then(async({value:l})=>{try{await p.post("/scoring-sets",{name:l}),s.success("新增成功！"),await b(),d.value.length>0&&x(d.value[d.value.length-1].id.toString())}catch{s.error("新增失败，可能是名称重复！")}}).catch(()=>{})},L=l=>{C.confirm(`确定删除【${l.name}】吗？其下的所有评分项将一并被删除！`,"严重警告",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await p.delete(`/scoring-sets/${l.id}`),s.success("删除成功！"),u.value=null,b()}catch{s.error("删除失败！")}})},x=l=>{u.value=parseInt(l),E()},E=async()=>{if(!u.value){v.value=[];return}try{const l=await p.get(`/scoring-sets/${u.value}/items`);v.value=l.data.data}catch{v.value=[],s.error("获取评分项列表失败")}},j=()=>{g.value=!1,i.value={name:"",description:"",max_score:10},_.value=!0},q=l=>{g.value=!0,i.value={...l},_.value=!0},J=l=>{C.confirm(`确定要删除评分项【${l.name}】吗？`,"确认",{type:"warning"}).then(async()=>{try{await p.delete(`/scoring-items/${l.id}`),s.success("删除成功！"),E()}catch{s.error("删除失败！")}})},O=async()=>{try{g.value?(await p.put(`/scoring-items/${i.value.id}`,i.value),s.success("更新成功！")):(await p.post(`/scoring-sets/${u.value}/items`,i.value),s.success("添加成功！")),_.value=!1,E()}catch{s.error("操作失败！")}},R=l=>{s.success(l.message||"导入成功！"),y.value=!1,u.value=null,b()},G=l=>{try{const e=JSON.parse(l.message);s.error(e.error||"导入失败，请检查文件格式或内容。")}catch{s.error("导入失败，请检查文件格式或联系服务器。")}};return le(b),(l,e)=>{const c=be,H=M("Delete"),I=re,K=se,P=ae,S=ye,k=ve,f=ge,Q=fe,W=_e,$=xe,w=ce,X=pe,Y=de,B=ue,Z=M("upload-filled"),ee=me;return V(),T(F,null,[t(W,{gutter:20},{default:a(()=>[t(k,{span:6},{default:a(()=>[t(S,null,{header:a(()=>[n("div",Ee,[e[9]||(e[9]=n("span",null,"评分组",-1)),n("div",null,[t(c,{type:"success",size:"small",onClick:e[0]||(e[0]=o=>y.value=!0)},{default:a(()=>[...e[7]||(e[7]=[r("导入",-1)])]),_:1}),t(c,{type:"primary",size:"small",onClick:A},{default:a(()=>[...e[8]||(e[8]=[r("新增",-1)])]),_:1})])])]),default:a(()=>[t(P,{"default-active":u.value?.toString(),onSelect:x},{default:a(()=>[(V(!0),T(F,null,oe(d.value,o=>(V(),ne(K,{key:o.id,index:o.id.toString()},{default:a(()=>[n("span",we,N(o.name),1),t(I,{class:"delete-icon",onClick:ie(D=>L(o),["stop"])},{default:a(()=>[t(H)]),_:1},8,["onClick"])]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),_:1})]),_:1}),t(k,{span:18},{default:a(()=>[t(S,null,{header:a(()=>[n("div",Ve,[n("span",null,"评分项列表 - "+N(z.value),1),t(c,{type:"primary",onClick:j,disabled:!u.value},{default:a(()=>[...e[10]||(e[10]=[r("添加评分项",-1)])]),_:1},8,["disabled"])])]),default:a(()=>[t(Q,{data:v.value,border:"",stripe:""},{default:a(()=>[t(f,{prop:"id",label:"ID",width:"60",align:"center"}),t(f,{prop:"name",label:"评分项名称"}),t(f,{prop:"description",label:"简介","show-overflow-tooltip":""}),t(f,{prop:"max_score",label:"满分",width:"80",align:"center"}),t(f,{label:"操作",width:"150",align:"center"},{default:a(({row:o})=>[t(c,{type:"primary",size:"small",onClick:D=>q(o)},{default:a(()=>[...e[11]||(e[11]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(c,{type:"danger",size:"small",onClick:D=>J(o)},{default:a(()=>[...e[12]||(e[12]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),t(B,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=o=>_.value=o),title:U.value,width:"500","append-to-body":""},{footer:a(()=>[n("div",Ce,[t(c,{onClick:e[4]||(e[4]=o=>_.value=!1)},{default:a(()=>[...e[13]||(e[13]=[r("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:O},{default:a(()=>[...e[14]||(e[14]=[r("确定",-1)])]),_:1})])]),default:a(()=>[t(Y,{model:i.value,"label-width":"100px"},{default:a(()=>[t(w,{label:"名称"},{default:a(()=>[t($,{modelValue:i.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.name=o)},null,8,["modelValue"])]),_:1}),t(w,{label:"简介"},{default:a(()=>[t($,{modelValue:i.value.description,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.description=o),type:"textarea"},null,8,["modelValue"])]),_:1}),t(w,{label:"满分"},{default:a(()=>[t(X,{modelValue:i.value.max_score,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.max_score=o),min:1,max:1e3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(B,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=o=>y.value=o),title:"批量导入评分组与评分项 (Excel)",width:"500","append-to-body":""},{default:a(()=>[t(ee,{drag:"",action:"/api/scoring-sets/import",name:"scoringFile",limit:1,"on-success":R,"on-error":G,accept:".xlsx, .xls"},{tip:a(()=>[...e[15]||(e[15]=[n("div",{class:"el-upload__tip"},[r(" 请上传 Excel 文件 (.xlsx, .xls)，且 **不要有表头**。"),n("br"),r(" - **A 列**: 评分组 (例如: 就业赛道)"),n("br"),r(" - **B 列**: 评分项名称 (例如: 职业目标)"),n("br"),r(" - **C 列**: 简介 (选填)"),n("br"),r(" - **D 列**: 满分 (例如: 50) ")],-1)])]),default:a(()=>[t(I,{class:"el-icon--upload"},{default:a(()=>[t(Z)]),_:1}),e[16]||(e[16]=n("div",{class:"el-upload__text"},[r(" 拖拽文件到此处 或 "),n("em",null,"点击上传")],-1))]),_:1})]),_:1},8,["modelValue"])],64)}}},Me=te(Ie,[["__scopeId","data-v-a7c68137"]]);export{Me as default};
